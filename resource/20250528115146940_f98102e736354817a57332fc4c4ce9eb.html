<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>拉格朗日中值定理与罗尔定理 - 高等数学教学演示</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /* 深色模式样式 */
        .dark {
            --tw-bg-opacity: 1;
            background-color: rgb(17 24 39 / var(--tw-bg-opacity));
            color: rgb(243 244 246 / var(--tw-text-opacity));
        }
        
        /* 平滑过渡 */
        * {
            transition: all 0.3s ease;
        }
        
        /* 卡片悬停效果 */
        .hover-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* 动画容器 */
        .animation-container {
            min-height: 300px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            position: relative;
        }
        
        .dark .animation-container {
            border-color: #374151;
        }
        
        /* 数学表达式容器 */
        .math-container {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border-radius: 12px;
            padding: 1.5rem;
        }
        
        .dark .math-container {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
        }
        
        /* 入场动画 */
        .fade-in {
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* 图标旋转动画 */
        .icon-spin:hover {
            transform: rotate(360deg);
        }
        
        /* 按钮悬停效果 */
        .btn-hover:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 min-h-screen">
    <!-- 主题切换按钮 -->
    <button id="themeToggle" class="fixed top-4 right-4 z-50 p-3 bg-white dark:bg-gray-800 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 btn-hover">
        <i class="fas fa-moon dark:hidden text-gray-600"></i>
        <i class="fas fa-sun hidden dark:block text-yellow-400"></i>
    </button>

    <!-- 页面标题区域 -->
    <header class="container mx-auto px-4 py-8 fade-in">
        <div class="text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 dark:text-white mb-4">
                <i class="fas fa-function text-indigo-600 dark:text-indigo-400 mr-3 icon-spin"></i>
                微分中值定理
            </h1>
            <p class="text-xl text-gray-600 dark:text-gray-300 mb-2">拉格朗日中值定理与罗尔定理</p>
            <div class="flex justify-center items-center space-x-4 text-sm text-gray-500 dark:text-gray-400">
                <span><i class="fas fa-graduation-cap mr-2"></i>高等数学</span>
                <span><i class="fas fa-clock mr-2"></i>2025年</span>
                <span><i class="fas fa-user mr-2"></i>IECUBE Tutorial</span>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 pb-8">
        <!-- 知识点概述 -->
        <section class="mb-12 fade-in">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 hover-card">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6">
                    <i class="fas fa-lightbulb text-yellow-500 mr-3"></i>
                    什么是微分中值定理？
                </h2>
                <p class="text-gray-600 dark:text-gray-300 text-lg leading-relaxed mb-4">
                    微分中值定理是微积分学中的重要定理群，它们建立了函数值与导数之间的关系。其中，罗尔定理和拉格朗日中值定理是最基础且重要的两个定理，它们为后续的泰勒公式、洛必达法则等奠定了理论基础。
                </p>
                <div class="grid md:grid-cols-2 gap-6 mt-6">
                    <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4">
                        <h3 class="font-semibold text-blue-800 dark:text-blue-300 mb-2">
                            <i class="fas fa-circle-dot mr-2"></i>罗尔定理
                        </h3>
                        <p class="text-blue-700 dark:text-blue-400 text-sm">
                            在满足特定条件下，连续可导函数在某点的导数为零
                        </p>
                    </div>
                    <div class="bg-indigo-50 dark:bg-indigo-900/30 rounded-lg p-4">
                        <h3 class="font-semibold text-indigo-800 dark:text-indigo-300 mb-2">
                            <i class="fas fa-circle-dot mr-2"></i>拉格朗日中值定理
                        </h3>
                        <p class="text-indigo-700 dark:text-indigo-400 text-sm">
                            函数的平均变化率等于某点的瞬时变化率
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 罗尔定理 -->
        <section class="mb-12 fade-in">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 hover-card">
                <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-6">
                    <i class="fas fa-circle text-blue-600 mr-3"></i>
                    罗尔定理 (Rolle's Theorem)
                </h2>
                
                <!-- 定理陈述 -->
                <div class="math-container mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">定理陈述</h3>
                    <p class="text-gray-700 dark:text-gray-300 mb-4">
                        设函数 $f(x)$ 满足以下条件：
                    </p>
                    <ol class="list-decimal list-inside space-y-2 text-gray-700 dark:text-gray-300 ml-4">
                        <li>在闭区间 $[a, b]$ 上连续</li>
                        <li>在开区间 $(a, b)$ 内可导</li>
                        <li>$f(a) = f(b)$</li>
                    </ol>
                    <p class="text-gray-700 dark:text-gray-300 mt-4 mb-4">
                        则在开区间 $(a, b)$ 内至少存在一点 $\xi$，使得：
                    </p>
                    <div class="text-center bg-white dark:bg-gray-900 p-4 rounded-lg border-l-4 border-blue-500">
                        <div id="rolle-formula" class="text-2xl"></div>
                    </div>
                </div>

                <!-- 几何意义 -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">
                        <i class="fas fa-shapes mr-2"></i>几何意义
                    </h3>
                    <p class="text-gray-700 dark:text-gray-300 mb-4">
                        如果一条连续曲线的两个端点具有相同的纵坐标，且曲线在整个区间内处处有切线，那么在曲线上至少有一点的切线是水平的。
                    </p>
                </div>

                <!-- 罗尔定理动画演示 -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">
                        <i class="fas fa-play-circle mr-2"></i>动态演示
                    </h3>
                    <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-6">
                        <canvas id="rolleCanvas" width="800" height="400" class="w-full border border-gray-300 dark:border-gray-600 rounded"></canvas>
                        <div class="flex justify-center space-x-4 mt-4">
                            <button id="startRolleAnimation" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors btn-hover">
                                <i class="fas fa-play mr-2"></i>开始演示
                            </button>
                            <button id="resetRolleAnimation" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors btn-hover">
                                <i class="fas fa-redo mr-2"></i>重置
                            </button>
                        </div>
                        <div class="mt-4 text-sm text-gray-600 dark:text-gray-400">
                            <p><strong>演示说明：</strong>红色曲线满足罗尔定理的条件，蓝色水平切线表示导数为零的点</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 拉格朗日中值定理 -->
        <section class="mb-12 fade-in">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 hover-card">
                <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-6">
                    <i class="fas fa-chart-line text-indigo-600 mr-3"></i>
                    拉格朗日中值定理 (Lagrange's Mean Value Theorem)
                </h2>
                
                <!-- 定理陈述 -->
                <div class="math-container mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">定理陈述</h3>
                    <p class="text-gray-700 dark:text-gray-300 mb-4">
                        设函数 $f(x)$ 满足以下条件：
                    </p>
                    <ol class="list-decimal list-inside space-y-2 text-gray-700 dark:text-gray-300 ml-4">
                        <li>在闭区间 $[a, b]$ 上连续</li>
                        <li>在开区间 $(a, b)$ 内可导</li>
                    </ol>
                    <p class="text-gray-700 dark:text-gray-300 mt-4 mb-4">
                        则在开区间 $(a, b)$ 内至少存在一点 $\xi$，使得：
                    </p>
                    <div class="text-center bg-white dark:bg-gray-900 p-4 rounded-lg border-l-4 border-indigo-500">
                        <div id="lagrange-formula" class="text-2xl"></div>
                    </div>
                    <p class="text-gray-700 dark:text-gray-300 mt-4 text-sm">
                        其中 $\frac{f(b) - f(a)}{b - a}$ 表示函数在区间 $[a, b]$ 上的平均变化率。
                    </p>
                </div>

                <!-- 几何意义 -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">
                        <i class="fas fa-shapes mr-2"></i>几何意义
                    </h3>
                    <p class="text-gray-700 dark:text-gray-300 mb-4">
                        在连续可导的曲线上，存在至少一点的切线平行于连接曲线两端点的割线。换句话说，曲线的瞬时变化率（切线斜率）等于平均变化率（割线斜率）。
                    </p>
                </div>

                <!-- 拉格朗日中值定理动画演示 -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">
                        <i class="fas fa-play-circle mr-2"></i>动态演示
                    </h3>
                    <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-6">
                        <canvas id="lagrangeCanvas" width="800" height="400" class="w-full border border-gray-300 dark:border-gray-600 rounded"></canvas>
                        <div class="flex justify-center space-x-4 mt-4">
                            <button id="startLagrangeAnimation" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors btn-hover">
                                <i class="fas fa-play mr-2"></i>开始演示
                            </button>
                            <button id="resetLagrangeAnimation" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors btn-hover">
                                <i class="fas fa-redo mr-2"></i>重置
                            </button>
                        </div>
                        <div class="mt-4 text-sm text-gray-600 dark:text-gray-400">
                            <p><strong>演示说明：</strong>红色曲线为函数图像，绿色直线为割线，蓝色直线为平行于割线的切线</p>
                        </div>
                    </div>
                </div>

                <!-- 参数调节 -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">
                        <i class="fas fa-sliders-h mr-2"></i>参数调节
                    </h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">区间左端点 a:</label>
                            <input type="range" id="paramA" min="-3" max="0" step="0.1" value="-2" class="w-full">
                            <span id="valueA" class="text-sm text-gray-600 dark:text-gray-400">-2</span>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">区间右端点 b:</label>
                            <input type="range" id="paramB" min="0" max="3" step="0.1" value="2" class="w-full">
                            <span id="valueB" class="text-sm text-gray-600 dark:text-gray-400">2</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 两定理的关系 -->
        <section class="mb-12 fade-in">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 hover-card">
                <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-6">
                    <i class="fas fa-link text-purple-600 mr-3"></i>
                    两定理的关系与应用
                </h2>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- 关系对比 -->
                    <div>
                        <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">
                            <i class="fas fa-balance-scale mr-2"></i>关系对比
                        </h3>
                        <div class="space-y-4">
                            <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-800 dark:text-blue-300 mb-2">罗尔定理</h4>
                                <ul class="text-blue-700 dark:text-blue-400 text-sm space-y-1">
                                    <li>• 特殊条件：$f(a) = f(b)$</li>
                                    <li>• 结论：$f'(\xi) = 0$</li>
                                    <li>• 几何：水平切线</li>
                                </ul>
                            </div>
                            <div class="bg-indigo-50 dark:bg-indigo-900/30 rounded-lg p-4">
                                <h4 class="font-semibold text-indigo-800 dark:text-indigo-300 mb-2">拉格朗日中值定理</h4>
                                <ul class="text-indigo-700 dark:text-indigo-400 text-sm space-y-1">
                                    <li>• 一般情况：无额外条件</li>
                                    <li>• 结论：$f'(\xi) = \frac{f(b)-f(a)}{b-a}$</li>
                                    <li>• 几何：平行于割线的切线</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/30 rounded-lg">
                            <p class="text-yellow-700 dark:text-yellow-400 text-sm">
                                <i class="fas fa-lightbulb mr-2"></i>
                                <strong>关键insight：</strong>罗尔定理是拉格朗日中值定理的特殊情况
                            </p>
                        </div>
                    </div>

                    <!-- 应用领域 -->
                    <div>
                        <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">
                            <i class="fas fa-rocket mr-2"></i>应用领域
                        </h3>
                        <div class="space-y-3">
                            <div class="bg-green-50 dark:bg-green-900/30 rounded-lg p-3">
                                <h4 class="font-medium text-green-800 dark:text-green-300">证明方程根的存在性</h4>
                                <p class="text-green-600 dark:text-green-400 text-sm">利用罗尔定理证明导函数零点的存在</p>
                            </div>
                            <div class="bg-purple-50 dark:bg-purple-900/30 rounded-lg p-3">
                                <h4 class="font-medium text-purple-800 dark:text-purple-300">洛必达法则</h4>
                                <p class="text-purple-600 dark:text-purple-400 text-sm">求解未定式极限的重要工具</p>
                            </div>
                            <div class="bg-red-50 dark:bg-red-900/30 rounded-lg p-3">
                                <h4 class="font-medium text-red-800 dark:text-red-300">泰勒公式</h4>
                                <p class="text-red-600 dark:text-red-400 text-sm">函数的多项式近似表示</p>
                            </div>
                            <div class="bg-orange-50 dark:bg-orange-900/30 rounded-lg p-3">
                                <h4 class="font-medium text-orange-800 dark:text-orange-300">单调性与极值</h4>
                                <p class="text-orange-600 dark:text-orange-400 text-sm">判断函数的单调性和求极值</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 经典例题 -->
        <section class="mb-12 fade-in">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 hover-card">
                <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-6">
                    <i class="fas fa-calculator text-green-600 mr-3"></i>
                    经典例题解析
                </h2>
                
                <div class="space-y-8">
                    <!-- 例题1 -->
                    <div class="border-l-4 border-blue-500 pl-6 bg-blue-50 dark:bg-blue-900/20 rounded-r-lg p-4">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-3">
                            <i class="fas fa-question-circle mr-2"></i>例题1：罗尔定理的应用
                        </h3>
                        <div class="mb-4">
                            <p class="text-gray-700 dark:text-gray-300 mb-3">
                                设 $f(x) = x^3 - 3x + 1$ 在区间 $[0, 2]$ 上，验证是否存在 $\xi \in (0, 2)$ 使得 $f'(\xi) = 0$。
                            </p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2"><strong>解析：</strong></p>
                            <p class="text-gray-700 dark:text-gray-300 text-sm mb-2">
                                首先检查罗尔定理的条件：
                            </p>
                            <ol class="list-decimal list-inside text-gray-700 dark:text-gray-300 text-sm space-y-1 ml-4">
                                <li>$f(x)$ 在 $[0, 2]$ 上连续（多项式函数）</li>
                                <li>$f(x)$ 在 $(0, 2)$ 内可导，$f'(x) = 3x^2 - 3$</li>
                                <li>$f(0) = 1$, $f(2) = 8 - 6 + 1 = 3$，不满足 $f(a) = f(b)$</li>
                            </ol>
                            <p class="text-red-600 dark:text-red-400 text-sm mt-2">
                                <strong>结论：</strong>不满足罗尔定理条件，但可用拉格朗日中值定理。
                            </p>
                        </div>
                    </div>

                    <!-- 例题2 -->
                    <div class="border-l-4 border-indigo-500 pl-6 bg-indigo-50 dark:bg-indigo-900/20 rounded-r-lg p-4">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-3">
                            <i class="fas fa-question-circle mr-2"></i>例题2：拉格朗日中值定理的应用
                        </h3>
                        <div class="mb-4">
                            <p class="text-gray-700 dark:text-gray-300 mb-3">
                                对函数 $f(x) = \ln x$ 在区间 $[1, e]$ 上应用拉格朗日中值定理，求中值点 $\xi$。
                            </p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2"><strong>解析：</strong></p>
                            <div class="space-y-2 text-gray-700 dark:text-gray-300 text-sm">
                                <div id="example-formula-1" class="text-center my-3"></div>
                                <div id="example-formula-2" class="text-center my-3"></div>
                                <div id="example-formula-3" class="text-center my-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 思考题区域 -->
        <section class="mb-12 fade-in">
            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/30 dark:to-orange-900/30 rounded-xl shadow-lg p-8 hover-card">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6">
                    <i class="fas fa-brain text-orange-600 mr-3"></i>
                    思考与延伸
                </h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                            <i class="fas fa-question mr-2 text-blue-500"></i>思考题
                        </h3>
                        <ol class="space-y-3 text-gray-700 dark:text-gray-300">
                            <li class="flex items-start">
                                <span class="font-medium text-blue-600 mr-2">1.</span>
                                <span>为什么罗尔定理要求 $f(a) = f(b)$？如果不满足会怎样？</span>
                            </li>
                            <li class="flex items-start">
                                <span class="font-medium text-blue-600 mr-2">2.</span>
                                <span>拉格朗日中值定理中的 $\xi$ 是否唯一？请举例说明。</span>
                            </li>
                            <li class="flex items-start">
                                <span class="font-medium text-blue-600 mr-2">3.</span>
                                <span>如何利用中值定理证明函数的单调性？</span>
                            </li>
                        </ol>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                            <i class="fas fa-arrow-up mr-2 text-green-500"></i>延伸学习
                        </h3>
                        <ul class="space-y-3 text-gray-700 dark:text-gray-300">
                            <li class="flex items-start">
                                <span class="text-green-600 mr-2">•</span>
                                <span>柯西中值定理（广义拉格朗日中值定理）</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-green-600 mr-2">•</span>
                                <span>洛必达法则的理论基础</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-green-600 mr-2">•</span>
                                <span>泰勒公式与泰勒级数</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-green-600 mr-2">•</span>
                                <span>函数凹凸性的判定</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- 页脚 -->
    <footer class="bg-gray-800 dark:bg-gray-900 text-white py-8 mt-16">
        <div class="container mx-auto px-4 text-center">
            <div class="mb-4">
                <h4 class="text-lg font-semibold mb-2">IECUBE Tutorial</h4>
                <p class="text-gray-400">© 2025 版权所有</p>
            </div>
            <div class="border-t border-gray-700 pt-4">
                <p class="text-sm text-gray-500">
                    本内容为人工智能生成，观点为转述原作者，不代表本公司立场，仅供参考和批判
                </p>
            </div>
        </div>
    </footer>

    <script>
        // 主题切换功能
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        
        // 检查系统主题偏好或本地存储
        function getInitialTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                return savedTheme;
            }
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }
        
        // 设置主题
        function setTheme(theme) {
            if (theme === 'dark') {
                html.classList.add('dark');
            } else {
                html.classList.remove('dark');
            }
            localStorage.setItem('theme', theme);
        }
        
        // 初始化主题
        setTheme(getInitialTheme());
        
        // 主题切换事件
        themeToggle.addEventListener('click', () => {
            const currentTheme = html.classList.contains('dark') ? 'dark' : 'light';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        });
        
        // 渲染数学公式
        function renderMath() {
            // 罗尔定理公式
            katex.render("f'(\\xi) = 0", document.getElementById('rolle-formula'), {
                throwOnError: false,
                displayMode: true
            });
            
            // 拉格朗日中值定理公式
            katex.render("f'(\\xi) = \\frac{f(b) - f(a)}{b - a}", document.getElementById('lagrange-formula'), {
                throwOnError: false,
                displayMode: true
            });
            
            // 例题公式
            katex.render("f'(\\xi) = \\frac{f(e) - f(1)}{e - 1} = \\frac{\\ln e - \\ln 1}{e - 1} = \\frac{1 - 0}{e - 1} = \\frac{1}{e - 1}", document.getElementById('example-formula-1'), {
                throwOnError: false,
                displayMode: true
            });
            
            katex.render("f'(x) = \\frac{1}{x}, \\text{ 所以 } f'(\\xi) = \\frac{1}{\\xi}", document.getElementById('example-formula-2'), {
                throwOnError: false,
                displayMode: true
            });
            
            katex.render("\\frac{1}{\\xi} = \\frac{1}{e - 1}, \\text{ 因此 } \\xi = e - 1 \\approx 1.718", document.getElementById('example-formula-3'), {
                throwOnError: false,
                displayMode: true
            });
        }
        
        // 罗尔定理动画
        function setupRolleAnimation() {
            const canvas = document.getElementById('rolleCanvas');
            const ctx = canvas.getContext('2d');
            const startBtn = document.getElementById('startRolleAnimation');
            const resetBtn = document.getElementById('resetRolleAnimation');
            
            let animationFrame;
            let progress = 0;
            let isAnimating = false;
            
            function drawRolleTheorem() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // 设置坐标系
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const scaleX = 80;
                const scaleY = 60;
                
                // 绘制坐标轴
                ctx.strokeStyle = '#6b7280';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(50, centerY);
                ctx.lineTo(canvas.width - 50, centerY);
                ctx.moveTo(centerX, 50);
                ctx.lineTo(centerX, canvas.height - 50);
                ctx.stroke();
                
                // 绘制函数曲线 f(x) = sin(x) + 0.5*sin(3x)
                ctx.strokeStyle = '#ef4444';
                ctx.lineWidth = 3;
                ctx.beginPath();
                
                for (let x = -Math.PI; x <= Math.PI; x += 0.01) {
                    const y = Math.sin(x) + 0.3 * Math.sin(3 * x);
                    const canvasX = centerX + x * scaleX;
                    const canvasY = centerY - y * scaleY;
                    
                    if (x === -Math.PI) {
                        ctx.moveTo(canvasX, canvasY);
                    } else {
                        ctx.lineTo(canvasX, canvasY);
                    }
                }
                ctx.stroke();
                
                // 标记端点
                const leftX = centerX - Math.PI * scaleX;
                const rightX = centerX + Math.PI * scaleX;
                const pointY = centerY; // f(-π) = f(π) = 0
                
                ctx.fillStyle = '#ef4444';
                ctx.beginPath();
                ctx.arc(leftX, pointY, 6, 0, 2 * Math.PI);
                ctx.arc(rightX, pointY, 6, 0, 2 * Math.PI);
                ctx.fill();
                
                // 绘制水平切线（如果动画进行中）
                if (progress > 0) {
                    // 找到导数为0的点（近似）
                    const xi1 = -Math.PI/2;
                    const xi2 = Math.PI/2;
                    
                    if (progress > 0.5) {
                        // 绘制第一个零点的切线
                        const x1 = centerX + xi1 * scaleX;
                        const y1 = centerY - (Math.sin(xi1) + 0.3 * Math.sin(3 * xi1)) * scaleY;
                        
                        ctx.strokeStyle = '#3b82f6';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(x1 - 40, y1);
                        ctx.lineTo(x1 + 40, y1);
                        ctx.stroke();
                        
                        // 标记点
                        ctx.fillStyle = '#3b82f6';
                        ctx.beginPath();
                        ctx.arc(x1, y1, 4, 0, 2 * Math.PI);
                        ctx.fill();
                    }
                    
                    if (progress > 0.7) {
                        // 绘制第二个零点的切线
                        const x2 = centerX + xi2 * scaleX;
                        const y2 = centerY - (Math.sin(xi2) + 0.3 * Math.sin(3 * xi2)) * scaleY;
                        
                        ctx.strokeStyle = '#3b82f6';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(x2 - 40, y2);
                        ctx.lineTo(x2 + 40, y2);
                        ctx.stroke();
                        
                        // 标记点
                        ctx.fillStyle = '#3b82f6';
                        ctx.beginPath();
                        ctx.arc(x2, y2, 4, 0, 2 * Math.PI);
                        ctx.fill();
                    }
                }
                
                // 添加标签
                ctx.fillStyle = '#374151';
                ctx.font = '14px Arial';
                ctx.fillText('a', leftX - 10, pointY + 25);
                ctx.fillText('b', rightX - 5, pointY + 25);
                ctx.fillText('f(a) = f(b)', leftX - 30, pointY - 15);
            }
            
            function animate() {
                if (isAnimating && progress < 1) {
                    progress += 0.02;
                    drawRolleTheorem();
                    animationFrame = requestAnimationFrame(animate);
                } else if (progress >= 1) {
                    isAnimating = false;
                }
            }
            
            startBtn.addEventListener('click', () => {
                if (!isAnimating) {
                    isAnimating = true;
                    animate();
                }
            });
            
            resetBtn.addEventListener('click', () => {
                isAnimating = false;
                progress = 0;
                if (animationFrame) {
                    cancelAnimationFrame(animationFrame);
                }
                drawRolleTheorem();
            });
            
            // 初始绘制
            drawRolleTheorem();
        }
        
        // 拉格朗日中值定理动画
        function setupLagrangeAnimation() {
            const canvas = document.getElementById('lagrangeCanvas');
            const ctx = canvas.getContext('2d');
            const startBtn = document.getElementById('startLagrangeAnimation');
            const resetBtn = document.getElementById('resetLagrangeAnimation');
            const paramA = document.getElementById('paramA');
            const paramB = document.getElementById('paramB');
            const valueA = document.getElementById('valueA');
            const valueB = document.getElementById('valueB');
            
            let animationFrame;
            let progress = 0;
            let isAnimating = false;
            let a = -2, b = 2;
            
            // 参数更新
            paramA.addEventListener('input', (e) => {
                a = parseFloat(e.target.value);
                valueA.textContent = a;
                if (!isAnimating) drawLagrangeTheorem();
            });
            
            paramB.addEventListener('input', (e) => {
                b = parseFloat(e.target.value);
                valueB.textContent = b;
                if (!isAnimating) drawLagrangeTheorem();
            });
            
            function f(x) {
                return 0.2 * x * x * x - x + 1;
            }
            
            function fprime(x) {
                return 0.6 * x * x - 1;
            }
            
            function drawLagrangeTheorem() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const scaleX = 60;
                const scaleY = 40;
                
                // 绘制坐标轴
                ctx.strokeStyle = '#6b7280';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(50, centerY);
                ctx.lineTo(canvas.width - 50, centerY);
                ctx.moveTo(centerX, 50);
                ctx.lineTo(centerX, canvas.height - 50);
                ctx.stroke();
                
                // 绘制函数曲线
                ctx.strokeStyle = '#ef4444';
                ctx.lineWidth = 3;
                ctx.beginPath();
                
                for (let x = -4; x <= 4; x += 0.01) {
                    const y = f(x);
                    const canvasX = centerX + x * scaleX;
                    const canvasY = centerY - y * scaleY;
                    
                    if (x === -4) {
                        ctx.moveTo(canvasX, canvasY);
                    } else {
                        ctx.lineTo(canvasX, canvasY);
                    }
                }
                ctx.stroke();
                
                // 标记端点
                const aX = centerX + a * scaleX;
                const aY = centerY - f(a) * scaleY;
                const bX = centerX + b * scaleX;
                const bY = centerY - f(b) * scaleY;
                
                ctx.fillStyle = '#ef4444';
                ctx.beginPath();
                ctx.arc(aX, aY, 6, 0, 2 * Math.PI);
                ctx.arc(bX, bY, 6, 0, 2 * Math.PI);
                ctx.fill();
                
                // 绘制割线
                ctx.strokeStyle = '#10b981';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(aX, aY);
                ctx.lineTo(bX, bY);
                ctx.stroke();
                
                // 计算平均变化率
                const avgRate = (f(b) - f(a)) / (b - a);
                
                // 找到满足条件的xi（数值方法近似）
                let xi = a;
                for (let x = a; x <= b; x += 0.01) {
                    if (Math.abs(fprime(x) - avgRate) < 0.05) {
                        xi = x;
                        break;
                    }
                }
                
                // 绘制切线（如果动画进行中）
                if (progress > 0.5) {
                    const xiX = centerX + xi * scaleX;
                    const xiY = centerY - f(xi) * scaleY;
                    
                    // 切线
                    const slope = fprime(xi);
                    const tangentLength = 100;
                    const dx = tangentLength / Math.sqrt(1 + slope * slope);
                    const dy = slope * dx;
                    
                    ctx.strokeStyle = '#3b82f6';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(xiX - dx, xiY + dy / scaleY * scaleX);
                    ctx.lineTo(xiX + dx, xiY - dy / scaleY * scaleX);
                    ctx.stroke();
                    
                    // 标记点
                    ctx.fillStyle = '#3b82f6';
                    ctx.beginPath();
                    ctx.arc(xiX, xiY, 6, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    // 添加文字说明
                    ctx.fillStyle = '#374151';
                    ctx.font = '12px Arial';
                    ctx.fillText(`ξ ≈ ${xi.toFixed(2)}`, xiX + 10, xiY - 10);
                }
                
                // 添加标签
                ctx.fillStyle = '#374151';
                ctx.font = '14px Arial';
                ctx.fillText(`a = ${a}`, aX - 10, aY + 25);
                ctx.fillText(`b = ${b}`, bX - 10, bY + 25);
                
                if (progress > 0.8) {
                    ctx.font = '12px Arial';
                    ctx.fillText(`平均变化率 = ${avgRate.toFixed(3)}`, 20, 30);
                    ctx.fillText(`f'(ξ) ≈ ${fprime(xi).toFixed(3)}`, 20, 50);
                }
            }
            
            function animate() {
                if (isAnimating && progress < 1) {
                    progress += 0.02;
                    drawLagrangeTheorem();
                    animationFrame = requestAnimationFrame(animate);
                } else if (progress >= 1) {
                    isAnimating = false;
                }
            }
            
            startBtn.addEventListener('click', () => {
                if (!isAnimating) {
                    isAnimating = true;
                    progress = 0;
                    animate();
                }
            });
            
            resetBtn.addEventListener('click', () => {
                isAnimating = false;
                progress = 0;
                if (animationFrame) {
                    cancelAnimationFrame(animationFrame);
                }
                drawLagrangeTheorem();
            });
            
            // 初始绘制
            drawLagrangeTheorem();
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            renderMath();
            setupRolleAnimation();
            setupLagrangeAnimation();
            
            // 添加滚动动画
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);
            
            // 观察所有需要动画的元素
            document.querySelectorAll('.fade-in').forEach(el => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(20px)';
                el.style.transition = 'opacity 0.8s ease-out, transform 0.8s ease-out';
                observer.observe(el);
            });
        });
        
        // 自适应canvas大小
        function resizeCanvas() {
            const canvases = document.querySelectorAll('canvas');
            canvases.forEach(canvas => {
                const parent = canvas.parentElement;
                const rect = parent.getBoundingClientRect();
                canvas.width = Math.min(800, rect.width - 40);
                canvas.height = Math.min(400, canvas.width * 0.5);
            });
            
            // 重新绘制
            if (typeof drawRolleTheorem === 'function') drawRolleTheorem();
            if (typeof drawLagrangeTheorem === 'function') drawLagrangeTheorem();
        }
        
        window.addEventListener('resize', resizeCanvas);
    </script>
</body>
</html>